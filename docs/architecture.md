# Multi-Agent Research 系统架构

本文档描述了Multi-Agent Research系统的架构设计和工作流程。

## 架构总览

该系统采用了基于LangGraph的状态图架构，由多个专业代理协作完成复杂的研究任务。系统的核心组件包括：

```
┌─────────────────┐     ┌─────────────────┐    ┌─────────────────┐
│                 │     │                 │    │                 │
│   协调者代理    │────►│    规划者代理   │───►│    研究员代理   │
│  (Coordinator)  │◄────│    (Planner)    │◄───│   (Researcher)  │
│                 │     │                 │    │                 │
└────────┬────────┘     └─────────────────┘    └────────┬────────┘
         │                                               │
         │                                               │
         │              ┌─────────────────┐              │
         │              │                 │              │
         └─────────────►│    撰写者代理   │◄─────────────┘
                        │     (Writer)    │
                        │                 │
                        └─────────────────┘
```

## 代理角色和职责

### 1. 协调者(Coordinator)

协调者是整个系统的入口点，负责：
- 理解初始研究问题和用户需求
- 根据当前状态决定下一步行动
- 协调各个专业代理的工作流程
- 决定何时需要深入研究，何时完成研究

### 2. 规划者(Planner)

规划者负责为研究问题制定详细的研究计划：
- 分析研究问题的核心和范围
- 将问题分解为多个子主题
- 为每个子主题创建具体的搜索查询
- 制定整体研究策略

### 3. 研究员(Researcher)

研究员负责执行搜索并处理结果：
- 执行由规划者确定的搜索查询
- 抓取相关网页内容
- 从搜索结果中提取关键信息
- 总结发现并提出后续研究方向

### 4. 撰写者(Writer)

撰写者负责整合所有研究发现：
- 分析和综合所有研究结果
- 组织信息成逻辑清晰的结构
- 生成全面的研究报告
- 提供引用和来源参考

## 工作流程

系统的工作流程如下：

1. **初始化阶段**：
   - 用户提供研究问题、深度和广度参数
   - 系统创建初始工作流状态

2. **规划阶段**：
   - 协调者将研究任务委托给规划者
   - 规划者分析问题并创建研究计划
   - 规划者返回结构化的计划，包括搜索查询

3. **研究阶段**：
   - 研究员执行搜索查询
   - 研究员处理搜索结果，提取关键信息
   - 研究员总结发现和后续问题

4. **深度探索阶段**（可选，基于深度参数）：
   - 协调者评估是否需要更深入研究
   - 如需深入，协调者会开始新的研究周期
   - 新周期基于之前的发现和后续问题

5. **报告生成阶段**：
   - 当达到指定深度或收集足够信息时
   - 协调者委托撰写者生成报告
   - 撰写者整合所有发现，生成最终报告

## 状态管理

系统使用LangGraph的状态图来管理工作流，包括：

- **状态定义**：通过`WorkflowState`接口定义系统状态
- **状态传递**：代理之间通过状态对象传递信息
- **决策路由**：基于协调者的决策动态选择下一步执行的代理

## 工具集成

系统集成了多种工具来增强研究能力：

1. **搜索工具**：支持多种搜索引擎，如Tavily, DuckDuckGo, Bing和Google
2. **内容抓取工具**：用于提取网页内容，转换为可处理的文本
3. **数据库服务**：用于存储研究任务和步骤，支持任务恢复和分析

## 扩展性

系统设计考虑了扩展性：

1. **添加新代理**：可以通过实现`AgentInterface`接口添加新的专业代理
2. **添加新工具**：可以通过实现`ToolInterface`接口添加新的工具
3. **修改工作流**：可以通过修改状态图定义调整代理之间的交互方式 